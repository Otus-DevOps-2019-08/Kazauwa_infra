# Bastion

### CI config

```
bastion_IP = 35.207.103.97
someinternalhost_IP = 10.156.0.3
```

### Прокидывание ssh во внутреннюю сеть через bastion хост

Для этого необходимо отредактировать файл `~/.ssh/config` и внести туда следующие настройки:
```
Host bastion
   HostName       <внешний ip адрес бастиона>
   User           <имя юзера>
   IdentityFile   ~/.ssh/<закрытый ключ>

Host 10.156.0.*
   User           <имя юзера>
   IdentityFile   ~/.ssh/<закрытый ключ>
   ProxyCommand   ssh -W %h:%p  <имя юзера>@bastion
```

Теперь, команда `ssh 10.156.0.<0-255>` будет создавать подключение к машине внутри приватной сети через бастион. Так как в настройках мы указали `Host 10.156.0.*`, эта конфигурация будет работать для любого адреса подсети `10.156.0.0/24`.


### Прокидывание ssh во внутреннюю сеть через bastion хост для конкретного хоста

Если хочется указать какую-то конкретную машину и воспользоваться всеми прелестями автодополнения, достаточно немного изменить конфигурацию выше:

```
Host bastion
   HostName       <внешний ip адрес бастиона>
   User           <имя юзера>
   IdentityFile   ~/.ssh/<закрытый ключ>

Host someinternalhost
   HostName       <ip адрес машины из приватной сети>
   User           <имя юзера>
   IdentityFile   ~/.ssh/<закрытый ключ>
   ProxyCommand   ssh -W %h:%p  <имя юзера>@bastion
```

Теперь, команда `ssh someinternalhost` будет создавать подключение к конкретному хосту через бастион.
